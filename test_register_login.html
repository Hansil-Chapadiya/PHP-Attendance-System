<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Register & Login - InfinityFree</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .section { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px; }
        input, select { width: 100%; padding: 10px; margin: 5px 0; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; cursor: pointer; margin: 10px 5px; }
        button:hover { background: #45a049; }
        .result { background: #fff; padding: 15px; margin: 10px 0; border-left: 4px solid #4CAF50; }
        .error { border-left-color: #f44336; }
        pre { background: #272822; color: #f8f8f2; padding: 15px; overflow-x: auto; border-radius: 5px; }
        h2 { color: #333; }
    </style>
</head>
<body>
    <h1>üß™ InfinityFree API Tester</h1>
    <p>Test Register aur Login endpoints directly from browser</p>

    <!-- API URL Setup -->
    <div class="section">
        <h2>üîß Setup</h2>
        <label>API Base URL:</label>
        <input type="text" id="apiUrl" placeholder="https://yoursite.infinityfreeapp.com/api" value="http://localhost/PHP-Attendance-System/api">
        <small>InfinityFree URL: https://yoursite.infinityfreeapp.com/api</small>
    </div>

    <!-- Register Test -->
    <div class="section">
        <h2>1Ô∏è‚É£ Test Register (Student)</h2>
        <input type="text" id="reg_username" placeholder="Username" value="test_student123">
        <input type="password" id="reg_password" placeholder="Password" value="Test@123">
        <input type="text" id="reg_fullname" placeholder="Full Name" value="Test Student">
        <input type="text" id="reg_branch" placeholder="Branch" value="Computer Science">
        <input type="text" id="reg_division" placeholder="Division (A-Z)" value="A">
        <input type="number" id="reg_semester" placeholder="Semester (1-8)" value="5">
        <button onclick="testRegister()">Register Student</button>
        <div id="register_result"></div>
    </div>

    <!-- Login Test -->
    <div class="section">
        <h2>2Ô∏è‚É£ Test Login (Student)</h2>
        <input type="text" id="login_username" placeholder="Username" value="student1">
        <input type="password" id="login_password" placeholder="Password" value="Pass@123">
        <button onclick="testLogin()">Login Student</button>
        <button onclick="testFacultyLogin()">Login Faculty</button>
        <div id="login_result"></div>
        <p><small>üí° Default: student1 / Pass@123 (Student) | faculty1 / Pass@123 (Faculty)</small></p>
    </div>

    <!-- Faculty Register Test -->
    <div class="section">
        <h2>3Ô∏è‚É£ Test Register (Faculty)</h2>
        <input type="text" id="fac_username" placeholder="Username" value="prof_sharma">
        <input type="password" id="fac_password" placeholder="Password" value="Prof@123">
        <input type="text" id="fac_fullname" placeholder="Full Name" value="Prof. Sharma">
        <input type="text" id="fac_branch" placeholder="Branch" value="Computer Science">
        <button onclick="testFacultyRegister()">Register Faculty</button>
        <div id="faculty_register_result"></div>
    </div>

    <!-- Direct URL Test -->
    <div class="section">
        <h2>4Ô∏è‚É£ Quick Endpoint Check</h2>
        <button onclick="checkEndpoint('register_user.php')">Check Register Endpoint</button>
        <button onclick="checkEndpoint('stud_login.php')">Check Student Login</button>
        <button onclick="checkEndpoint('faculty_login.php')">Check Faculty Login</button>
        <div id="endpoint_result"></div>
    </div>

    <script>
        function getApiUrl() {
            return document.getElementById('apiUrl').value.replace(/\/$/, '');
        }

        async function testRegister() {
            const resultDiv = document.getElementById('register_result');
            resultDiv.innerHTML = '<p>üîÑ Registering student...</p>';

            const data = {
                username: document.getElementById('reg_username').value,
                password: document.getElementById('reg_password').value,
                full_name: document.getElementById('reg_fullname').value,
                role: 'student',
                branch: document.getElementById('reg_branch').value,
                division: document.getElementById('reg_division').value,
                semester: parseInt(document.getElementById('reg_semester').value)
            };

            try {
                const response = await fetch(getApiUrl() + '/register_user.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                resultDiv.innerHTML = `
                    <div class="result ${result.status === 'error' ? 'error' : ''}">
                        <strong>Status:</strong> ${response.status} ${response.statusText}<br>
                        <strong>Response:</strong>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error"><strong>Error:</strong> ${error.message}</div>`;
            }
        }

        async function testFacultyRegister() {
            const resultDiv = document.getElementById('faculty_register_result');
            resultDiv.innerHTML = '<p>üîÑ Registering faculty...</p>';

            const data = {
                username: document.getElementById('fac_username').value,
                password: document.getElementById('fac_password').value,
                full_name: document.getElementById('fac_fullname').value,
                role: 'faculty',
                branch: document.getElementById('fac_branch').value
            };

            try {
                const response = await fetch(getApiUrl() + '/register_user.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                resultDiv.innerHTML = `
                    <div class="result ${result.status === 'error' ? 'error' : ''}">
                        <strong>Status:</strong> ${response.status} ${response.statusText}<br>
                        <strong>Response:</strong>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error"><strong>Error:</strong> ${error.message}</div>`;
            }
        }

        async function testLogin() {
            const resultDiv = document.getElementById('login_result');
            resultDiv.innerHTML = '<p>üîÑ Logging in...</p>';

            const data = {
                username: document.getElementById('login_username').value,
                password: document.getElementById('login_password').value
            };

            try {
                const response = await fetch(getApiUrl() + '/stud_login.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                // Save token if login successful
                if (result.status === 'success' && result.token) {
                    localStorage.setItem('auth_token', result.token);
                    localStorage.setItem('user_role', 'student');
                }

                resultDiv.innerHTML = `
                    <div class="result ${result.status === 'error' ? 'error' : ''}">
                        <strong>Status:</strong> ${response.status} ${response.statusText}<br>
                        <strong>Response:</strong>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                        ${result.token ? '<p>‚úÖ Token saved in localStorage!</p>' : ''}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error"><strong>Error:</strong> ${error.message}</div>`;
            }
        }

        async function testFacultyLogin() {
            const resultDiv = document.getElementById('login_result');
            resultDiv.innerHTML = '<p>üîÑ Logging in as faculty...</p>';

            const data = {
                username: document.getElementById('login_username').value,
                password: document.getElementById('login_password').value
            };

            try {
                const response = await fetch(getApiUrl() + '/faculty_login.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                // Save token if login successful
                if (result.status === 'success' && result.token) {
                    localStorage.setItem('auth_token', result.token);
                    localStorage.setItem('user_role', 'faculty');
                }

                resultDiv.innerHTML = `
                    <div class="result ${result.status === 'error' ? 'error' : ''}">
                        <strong>Status:</strong> ${response.status} ${response.statusText}<br>
                        <strong>Response:</strong>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                        ${result.token ? '<p>‚úÖ Token saved in localStorage!</p>' : ''}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error"><strong>Error:</strong> ${error.message}</div>`;
            }
        }

        async function checkEndpoint(filename) {
            const resultDiv = document.getElementById('endpoint_result');
            resultDiv.innerHTML = '<p>üîÑ Checking endpoint...</p>';

            const url = getApiUrl() + '/' + filename;

            try {
                const response = await fetch(url, {
                    method: 'GET',
                });

                const text = await response.text();
                let result;
                try {
                    result = JSON.parse(text);
                } catch {
                    result = text;
                }

                resultDiv.innerHTML = `
                    <div class="result">
                        <strong>URL:</strong> <a href="${url}" target="_blank">${url}</a><br>
                        <strong>Status:</strong> ${response.status} ${response.statusText}<br>
                        <strong>Response:</strong>
                        <pre>${typeof result === 'object' ? JSON.stringify(result, null, 2) : result}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        <strong>URL:</strong> ${url}<br>
                        <strong>Error:</strong> ${error.message}<br>
                        <p>‚ö†Ô∏è Endpoint not accessible! Check if file exists on server.</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
